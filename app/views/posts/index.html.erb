<div class="max-w-2xl mx-auto">
  <h1 class="text-3xl font-bold mb-6">Your Feed</h1>

  <%= form_with model: @post, url: posts_path, class: "bg-white border border-gray-300 rounded-lg p-4 mb-6" do |f| %>
    <div class="mb-4">
      <%= f.text_area :body, placeholder: "What's on your mind?", rows: 3, class: "w-full border border-gray-200 rounded px-3 py-2" %>
    </div>

    <div class="text-right">
      <%= f.submit "Post", class: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded" %>
    </div>
  <% end %>

  <% if @posts.any? %>
    <% @posts.each do |post| %>
      <article class="bg-white border border-gray-300 rounded-lg p-4 mb-4">
        <div class="flex items-center justify-between mb-3">
          <strong><%= link_to post.user.email, user_path(post.user), class: "text-blue-600 hover:underline" %></strong>
          <small class="text-gray-500"><%= time_ago_in_words(post.created_at) %> ago</small>
        </div>

        <p class="text-gray-800 mb-3"><%= post.body %></p>

        <div class="text-sm text-gray-500 mb-3">
          <%= pluralize(post.likes.count, "like") %> Â· <%= pluralize(post.comments.count, "comment") %>
        </div>

        <div class="flex gap-2 mb-4">
          <% if post.likes.exists?(user: current_user) %>
            <% like = post.likes.find_by(user: current_user) %>
            <%= button_to "Unlike", post_like_path(post, like), method: :delete, class: "text-red-600 hover:text-red-700 font-medium" %>
          <% else %>
            <%= button_to "Like", post_likes_path(post), method: :post, class: "text-gray-600 hover:text-blue-600 font-medium" %>
          <% end %>
          <%= link_to "Comment", post_path(post), class: "text-gray-600 hover:text-blue-600 font-medium" %>
        </div>

        <% if post.comments.any? %>
          <div class="border-t border-gray-200 pt-3">
            <% post.comments.limit(3).each do |comment| %>
              <p class="text-sm mb-2">
                <strong><%= link_to comment.user.email, user_path(comment.user), class: "text-blue-600 hover:underline" %></strong>
                <span class="text-gray-700"><%= comment.body %></span>
              </p>
            <% end %>
            <% if post.comments.count > 3 %>
              <%= link_to "View all #{post.comments.count} comments", post_path(post), class: "text-blue-600 hover:underline text-sm" %>
            <% end %>
          </div>
        <% end %>

        <div class="mt-3 pt-3 border-t border-gray-200">
          <%= form_with model: [post, Comment.new], local: true do |f| %>
            <div class="flex gap-2">
              <%= f.text_field :body, placeholder: "Write a comment...", class: "flex-1 border border-gray-200 rounded px-3 py-2 text-sm" %>
              <%= f.submit "Comment", class: "bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded text-sm" %>
            </div>
          <% end %>
        </div>
      </article>
    <% end %>
  <% else %>
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 text-center">
      <p class="text-gray-600 mb-4">Your feed is empty. Follow someone to get started!</p>
      <%= link_to "Discover Users", users_path, class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded inline-block" %>
    </div>
  <% end %>
</div>
